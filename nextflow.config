k8s {
   namespace = 'medgen-ns'
   runAsUser = 1000
   storageClaimName = 'pvc-713003-pospisilova-base'
   storageMountPath = '/mnt'
   pod = [ [volumeClaim: 'pvc-713003-pospisilova-cmbg', mountPath: "/cmbg" ]]
   homeDir = '/cmbg/TP53downs/src'
   launchDir = "${k8s.homeDir}/launch"
   projectDir = "${k8s.homeDir}/project"
   workDir = "${k8s.homeDir}/temp"
   computeResourceType = 'Job'
}

params {
   homeDir = '/cmbg/TP53downs/src'

   outDirectory = '/cmbg/TP53downs/data'
   projectDirectory = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling"
   bwa_index_mouse = '/mnt/references/Mus_musculus/BWA/GRCm38.p6-93'
   bwa_index_zebrafish = '/mnt/references/zebrafish/BWA/GRCz11-102'
   ref = '/mnt/references/Homo_sapiens/GRCh37-p13/seq/GRCh37-p13'
   vep = '/mnt/references/Homo_sapiens/GRCh37-p13/VEP'
   refindex = '/mnt/references/Homo_sapiens/GRCh37-p13/index/BWA/GRCh37-p13'
   gatk36 = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/bin/GenomeAnalysisTK.jar"
   teststrandbias = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/teststrandbias.R"
   var2vcf_valid = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/var2vcf_valid.pl"

   
   // varbed = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/beds/fastgen_tp53_NoChr.bed"
   // covbed = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/beds/fastgen_tp53_NoChr.gff"

   varbed = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/beds/p53_amplicons.2-11exons.merged.bed"
   covbed = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/beds/p53_exons+beta_splice2nt.gff"
   vcf_simplify = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/vcf-simplify.py"
   create_table = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/rearange_table_NEW.R"
   coverstat = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/coverage_final_table.R"
   filesender = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/filesender.py"
   bar_plots = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/BarPlots.py" //from final .vcfs
   interactive_bar_plots = "${k8s.projectDir}/kamilareblova/TP53_nfdownsampling/scripts/InteractiveBarPlots.py" //from .bams
}

executor {
   queueSize = 50
}

process {
   container = 'xreblova/tp53downshg37:v1'
   shell = ['/bin/bash', '-eo', 'pipefail']
   scratch = true
   executor = 'k8s'
   pod = [[imagePullSecret:'gitlab-svaton-secret'], [securityContext:[fsGroupChangePolicy:'OnRootMismatch', allowPrivilegeEscalation:false, runAsUser:1000, runAsGroup:1, fsGroup:1, capabilities:[drop:['ALL']]]], [nodeSelector:'storage=local-ssd']]
   // errorStrategy = { task.exitStatus in [143,137,104,134,139,247, null, ''] ? 'retry' : 'finish' }
   errorStrategy = "retry"
   maxRetries = 3
   cpus = 1
   memory = '100GB'

   withLabel: xxs_mem {
      memory = {10.GB * task.attempt * (3/4)}
   }
   withLabel: xs_mem {
      memory = {10.GB * task.attempt * (3/4)}
   }
   withLabel: s_mem {
      memory = {10.GB * task.attempt * (3/4)}
   }
   withLabel: m_mem {
      memory = {10.GB * task.attempt * (3/4)}
   }
   withLabel: l_mem {
      memory = {100.GB * task.attempt * (3/4)}
   }     
   withLabel: xl_mem {
      memory = {100.GB * task.attempt * (3/4)}
   } 
   withLabel: s_cpu {
      cpus = 1
   }
   withLabel: m_cpu {
      cpus = 4
   }
   withLabel: l_cpu {
      cpus = 8
   }
}
